---
title: "DSCF Quiz 3"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: false
runtime: shiny_prerendered
---

```{r setup, include=FALSE, message=FALSE, warnings = F}
library(learnr)
library(tidyverse)
library(lubridate)
knitr::opts_chunk$set(message = FALSE, warning = FALSE, cache = FALSE,
                      fig.width = 9, fig.height = 6,fig.align = "center",
                      tidy = FALSE, strip.white = TRUE, out.width = '100%')
library(gt)
bd_txt <- function(x,title = "Grading",subtitle = "-", width = 700) {
  if (nchar(gsub(" ","",subtitle))==0) {subtitle <- "-"}
  y <- x %>% gt::gt() %>%
    gt::tab_header(title = title, subtitle = subtitle) %>%
    gt::tab_style(style = cell_text(weight = "bold"),
                  locations = cells_column_labels(colnames(.))) %>%
    gt::tab_style(style = list(cell_fill(color = "royalblue"),
                               cell_text(color = "white",weight = "bold")),
                  locations = cells_title(groups = c("title")))
  y= y %>% tab_options(table.width = px(width),table.font.size = pct(80))
  return(y)
}

bd_lo <- function(x,width=700) {
  y <- x %>% gt::gt(rowname_col = rownames(.)) %>%
    gt::tab_header(title = "Learning Objectives",
                   subtitle = "Desired Outcomes Sought for Mastery of Material") %>%
    gt::tab_style(style = cell_text(weight = "bold"),
                  locations = cells_column_labels(colnames(.))) %>%
    gt::tab_style(style = list(cell_fill(color = "royalblue"),
                               cell_text(color = "white",weight = "bold")),
                  locations = cells_title(groups = c("title")))
  y= y %>% tab_options(table.width = px(width),table.font.size = pct(80))
  return(y)
}


from = as.Date("2008-01-01")
to = lubridate::rollback(Sys.Date())
```

## Problem We Are Solving

**This quiz consists in performing a multivariate regression.**

This exercise is quiz #3 - see grading section.

### Variables considered:


+ NANR with the [SPDR® S&P® North American Natural Resources ETF](https://www.ssga.com/us/en/individual/etfs/funds/spdr-sp-north-american-natural-resources-etf-nanr).
+ US equities with the [SPDR S&P 500 ETF](https://etfdb.com/etf/SPY/#etf-ticker-profile).
+ Oil with the [United States Oil Fund](https://etfdb.com/etf/USO/#etf-ticker-profile).
+ Natural Gas with the [United States Natural Gas Fund](https://www.uscfinvestments.com/ung).
+ Gold with the [SPDR Gold Trust](https://etfdb.com/etf/GLD/#etf-ticker-profile).
+ Silver with the [iShares Silver Trust](https://www.ishares.com/us/products/239855/ishares-silver-trust-fund).

```{r}
tickers <-  c("NANR","SPY","USO","UNG","GLD","SLV")
```

### Your Ask

In a concise .Rmd using `tidy` (i.e. no `xts`), do the following:

1. Extract data from `r from` to `r to` and compute daily `log()` returns. It is not necessary to display in your document as this is the data wrangling of it.
2. Plot a histogram of returns by asset class.
3. Show a table of return distribution with each moments with a short commentary on they compare with a normal distribution.
4. Compute the Jarque-Bera statistics.

  + Display the results.
  + State which one are normally distributed and which ones are not. 
5. Compute the Kolmogorov-Smirnov (“KS”) on `SPY` returns and state whether the results indicate that the returns are normally distributed.

6. I am your business leader and, despite knowing markets at a high level, my Finance background is quite limited... Tell me in a few bullet points what the key messages I should draw from your analysis so I can cut and paste them in a Powerpoint to my boss. Add this section at the beginning of the document in a summary section.  


## Grading

At this point in the class, more differentiation will be applied in grading. This is an advanced class in your learning in your degree and/or professional workplace and you are judged both on absolute and relative standards versus your peers.

```{r, echo=F,include=TRUE, fig.height=3}
tibble(Competency=c("Summary",
                    "Presentation",
                    "Accuracy of code and results"),
           Measure=c("Ability to distill and communicate the key findings.",
                   "Professionally rendered presentations. Clean document of unnecessary clutter not relevant to the story. I am a business leader and interested in the story, not how you got to it.",
                   "No errors in computations."),
           Score=c("2 points",
                   "2 points",
                   "6 points")) %>% bd_lo()
```

## Solution Hint

**No hints provided**

```{r, echo = F}
#from = "2013-01-01"
#to = "2018-01-01"

library(tidyquant)
ret <- tidyquant::tq_get(tickers,
              get  = "stock.prices",
              from = from,
              to = to) %>% 
  dplyr::select(date, symbol,close = adjusted) %>% 
  dplyr::group_by(symbol) %>% 
  dplyr::mutate(ret = log(close / dplyr::lag(close)))  %>% 
  tidyr::pivot_wider(date, names_from = symbol, values_from = ret) %>% 
  stats::na.omit()
```


```{r, echo = F}
fit1 <- stats::lm(NANR ~ SPY,ret)
fit2 <- stats::lm(NANR ~ SPY + USO,ret)
fit3 <- stats::lm(NANR ~ SPY + USO + UNG,ret)
fit4 <- stats::lm(NANR ~ SPY + USO + UNG + GLD,ret)
fit5 <- stats::lm(NANR ~ SPY + USO + UNG + GLD + SLV,ret)
```

```{r, echo = F}
ret %>% GGally::ggpairs()
```
```{r, echo = F}
ret %>% RTL::chart_pairs()
```

```{r, echo = F}
library(broom)
fit1 %>% broom::glance() %>% 
  dplyr::add_row(fit2 %>% broom::glance()) %>% 
  dplyr::add_row(fit3 %>% broom::glance()) %>% 
  dplyr::add_row(fit4 %>% broom::glance()) %>% 
  dplyr::add_row(fit5 %>% broom::glance()) %>% dplyr::select(1:5)
```

```{r, eval = F}
car::vif(fit2)
car::vif(fit3)
car::vif(fit4)
car::vif(fit5)
```
```{r, echo = F}
fitfinal <- stats::lm(NANR ~ SPY + USO + GLD,ret)
summary(fitfinal)
```

